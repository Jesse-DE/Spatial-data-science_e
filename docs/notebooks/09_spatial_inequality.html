

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spatial Inequality &#8212; Geographic Data Science with Python</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://geographicdata.science/book/notebooks/09_spatial_inequality.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Clustering &amp; Regionalization" href="10_clustering_and_regionalization.html" />
    <link rel="prev" title="Point Pattern Analysis" href="08_point_pattern_analysis.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="https://geographicdata.science/book/notebooks/09_spatial_inequality.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Spatial Inequality" />
<meta property="og:description" content="Spatial Inequality  Introduction  Social and economic inequality is often at the top of policy makers’ agendas. It has always drawn considerable attention in ac" />
<meta property="og:image"       content="https://geographicdata.science/book/_static/logo.png" />

<meta name="twitter:card" content="summary">


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Geographic Data Science with Python</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Home
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Preface
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="00_toc.html">
   Table of Contents
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="references.html">
   References
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part I - Building Blocks
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro_part_i.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_geospatial_computational_environment.html">
   Geospatial Computational Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_spatial_data.html">
   Geographic thinking for data scientists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_spatial_data_processing.html">
   Spatial Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_spatial_weights.html">
   Spatial Weights
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part II - Spatial Data Analysis
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro_part_ii.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_choropleth.html">
   Choropleth Mapping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_spatial_autocorrelation.html">
   Global Spatial Autocorrelation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_local_autocorrelation.html">
   Local Spatial Autocorrelation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_point_pattern_analysis.html">
   Point Pattern Analysis
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part III - Advanced Topics
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro_part_ii.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Spatial Inequality
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#questions">
   Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_clustering_and_regionalization.html">
   Clustering &amp; Regionalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_regression.html">
   Spatial Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_feature_engineering.html">
   Spatial Feature Engineering
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Datasets
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../data/README.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/airbnb/regression_cleaning.html">
   AirBnb
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/airports/airports_cleaning.html">
   Airports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/brexit/brexit_cleaning.html">
   Brexit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/countries/countries_cleaning.html">
   Countries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/h3_grid/build_sd_h3_grid.html">
   H3 Grid
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/mexico/README.html">
   Mexico
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/nasadem/build_nasadem_sd.html">
   NASA DEM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/sandiego/sandiego_tracts_cleaning.html">
   San Diego Tracts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/texas/README.html">
   Texas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/tokyo/tokyo_cleaning.html">
   Tokyo Photographs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/us_county_income/README.html">
   US County Income 1969-2017
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/09_spatial_inequality.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/gdsbook/book/master?urlpath=lab/tree/notebooks/09_spatial_inequality.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/gdsbook/book/blob/master/notebooks/09_spatial_inequality.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> On this page
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-us-state-per-capita-income-1969-2017">
   Data: US State Per-Capita Income 1969-2017
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#global-inequality">
   Global Inequality
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ratio">
     20:20 Ratio
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gini-index">
     Gini Index
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#theil-s-index">
     Theil’s index
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#personal-versus-regional-income">
   Personal versus Regional Income
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   Spatial Inequality
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spatial-autocorrelation">
     Spatial Autocorrelation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decompositional-approaches">
     Decompositional Approaches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regional-inequality-decompositions">
     Regional Inequality Decompositions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regional-decomposition-of-inequality">
   Regional Decomposition of Inequality
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spatializing-classic-measures">
     Spatializing Classic Measures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spatial-gini">
       Spatial Gini
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="spatial-inequality">
<h1>Spatial Inequality<a class="headerlink" href="#spatial-inequality" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Social and economic inequality is often at the top of policy makers’ agendas.
It has always drawn considerable attention in academic circles. Currently,
the world is extremely unequal, stratified, and segregated; no matter the
society or economic system, inequality is at a high point. Much of the focus
has been on <em>interpersonal income inequality</em>, yet there is a growing recognition
that the question of <em>interregional income inequality</em> requires further
attention as the growing gaps between poor and rich regions have been identified
as key drivers of political polarization in developing and developed countries
<a class="bibtex reference internal" href="references.html#rodriguez-pose-2018" id="id1">[RP18]</a>.</p>
<p>Indeed, while the two literatures (personal and regional inequality) are
related, they have developed in a largely parallel fashion with limited
cross-fertilization. In this notebook, we examine how a spatially explicit focus
can provide insights on inequality and its dynamics. We also show the lineage of
regional inequality analysis to make explicit the linkage between it and the
older literature on personal inequality analysis.</p>
<p>We begin with an introduction to classic methods for interpersonal income
inequality analysis and how they have been adopted to the question of regional
inequalities. These include a number of graphical tools along side familiar
indices of inequality. As we discuss more fully, the use of these classical
methods in spatially referenced data, while useful in providing insights on some
of the aspects of spatial inequality, fails to fully capture the nature of
geographical disparities and their dynamics. Thus, we next move to spatially
explicit measures for regional inequality analysis. The notebook closes with
some recent extensions of some classical measures to more fully examine the
spatial dimensions of regional inequality dynamics.</p>
</div>
<div class="section" id="data-us-state-per-capita-income-1969-2017">
<h2>Data: US State Per-Capita Income 1969-2017<a class="headerlink" href="#data-us-state-per-capita-income-1969-2017" title="Permalink to this headline">¶</a></h2>
<p>For this chapter, we focus on the case of the United States from 1969 to 2017. Specifically, we will analyze median incomes at the county level, examining the trends both in terms of how individual counties, states, or regions get richer or poorer, as well as how the overall distribution of income moves, skews, or spreads out.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">seaborn</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">pysal</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">mapclassify</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;../data/us_county_income/uscountypcincome.gpkg&#39;</span><span class="p">)</span>
<span class="n">pci_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>STATEFP</th>
      <th>COUNTYFP</th>
      <th>COUNTYNS</th>
      <th>GEOID</th>
      <th>NAME</th>
      <th>NAMELSAD</th>
      <th>LSAD</th>
      <th>CLASSFP</th>
      <th>MTFCC</th>
      <th>CSAFP</th>
      <th>...</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>index</th>
      <th>IndustryCl</th>
      <th>Descript_1</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>55</td>
      <td>111</td>
      <td>01581115</td>
      <td>55111</td>
      <td>Sauk</td>
      <td>Sauk County</td>
      <td>06</td>
      <td>H1</td>
      <td>G4020</td>
      <td>357</td>
      <td>...</td>
      <td>39988</td>
      <td>40655</td>
      <td>42668</td>
      <td>44255</td>
      <td>44540</td>
      <td>45847</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>POLYGON ((-90.19196 43.55500, -90.31107 43.553...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>55</td>
      <td>093</td>
      <td>01581107</td>
      <td>55093</td>
      <td>Pierce</td>
      <td>Pierce County</td>
      <td>06</td>
      <td>H1</td>
      <td>G4020</td>
      <td>378</td>
      <td>...</td>
      <td>39121</td>
      <td>39367</td>
      <td>41626</td>
      <td>43539</td>
      <td>43488</td>
      <td>44636</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>POLYGON ((-92.69454 44.68874, -92.73204 44.714...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>55</td>
      <td>063</td>
      <td>01581091</td>
      <td>55063</td>
      <td>La Crosse</td>
      <td>La Crosse County</td>
      <td>06</td>
      <td>H1</td>
      <td>G4020</td>
      <td>None</td>
      <td>...</td>
      <td>41759</td>
      <td>41230</td>
      <td>43637</td>
      <td>45067</td>
      <td>45985</td>
      <td>47134</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>POLYGON ((-91.34774 43.91196, -91.42519 43.984...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>55</td>
      <td>033</td>
      <td>01581076</td>
      <td>55033</td>
      <td>Dunn</td>
      <td>Dunn County</td>
      <td>06</td>
      <td>H1</td>
      <td>G4020</td>
      <td>232</td>
      <td>...</td>
      <td>35909</td>
      <td>35940</td>
      <td>36752</td>
      <td>36835</td>
      <td>37151</td>
      <td>38345</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>POLYGON ((-92.13538 44.94481, -92.15646 45.209...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>55</td>
      <td>053</td>
      <td>01581086</td>
      <td>55053</td>
      <td>Jackson</td>
      <td>Jackson County</td>
      <td>06</td>
      <td>H1</td>
      <td>G4020</td>
      <td>None</td>
      <td>...</td>
      <td>39319</td>
      <td>38620</td>
      <td>40260</td>
      <td>41189</td>
      <td>41181</td>
      <td>43185</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>POLYGON ((-91.16601 44.33510, -91.16562 44.596...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 77 columns</p>
</div></div></div>
</div>
<p>Inspection of the head of the data frame reveals that the years appear as columns in the data set, together with information about the particular record.
This format is an example of a <a class="reference external" href="https://en.wikipedia.org/wiki/Wide_and_narrow_data"><em>wide</em> longitudinal data set</a>.
In wide-format data, each column represents a different time period, meaning that each row represents a set of measurements made about the same “entity” over time time (as well as any unique identifying information about that entity.)
This contrasts with a <em>narrow</em> or <em>long</em> format, where each row describes an entity at a specific point in time.
Long data results in significant duplication for records and is generally worse for data storage. However, long form data is sometimes a more useful format when manipulating and analyzing data, as <span class="bibtex" id="id2">[Wickham_2014]</span> discusses. Nonetheless, when analyzing <em>trajectories</em>, that is, the paths that entities take over time, wide data is more useful, and we will use that here.</p>
<p>In this data, we have 3076 counties across 49 years, as well as 28 extra columns that describe each county.</p>
<!-- 
ljw: we (1) don't discuss wide vs. long anywhere else in the book and (2) don't ever show a wide-to-long pivot using something like pandas.wide_to_long... We also don't need the LineCode filtering, since the final dataframe is already filtered by LineCode so that all LineCode==3.
-->
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>(3076, 77)
</pre></div>
</div>
</div>
</div>
<p>As an example, we can see the first few years for Jackson Counti, Mississippi below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;NAME == &quot;Jackson&quot; &amp; STATEFP == &quot;28&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>STATEFP</th>
      <th>COUNTYFP</th>
      <th>COUNTYNS</th>
      <th>GEOID</th>
      <th>NAME</th>
      <th>NAMELSAD</th>
      <th>LSAD</th>
      <th>CLASSFP</th>
      <th>MTFCC</th>
      <th>CSAFP</th>
      <th>...</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>index</th>
      <th>IndustryCl</th>
      <th>Descript_1</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1417</th>
      <td>28</td>
      <td>059</td>
      <td>00695753</td>
      <td>28059</td>
      <td>Jackson</td>
      <td>Jackson County</td>
      <td>06</td>
      <td>H1</td>
      <td>G4020</td>
      <td>None</td>
      <td>...</td>
      <td>34586</td>
      <td>34494</td>
      <td>34905</td>
      <td>35429</td>
      <td>35890</td>
      <td>36449</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>POLYGON ((-88.82351 30.38205, -88.88453 30.677...</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 77 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="global-inequality">
<h2>Global Inequality<a class="headerlink" href="#global-inequality" title="Permalink to this headline">¶</a></h2>
<p>We begin our examination of inequality by focusing on several global measures of income inequlity. Here, “global” means that the measure is concerned with the overall nature of inequality within the income distribution. That is, these measures focus on the direct disparity between rich and poor, considering nothing about where the rich and poor live. Several classic measures of inequality are available for this purpose.</p>
<p>In general terms, measures of inequality focus on the dispersion present in an income distribution. In the case of regional or spatial inequality, the distributions describe the average or per-capita incomes for spatial units, such as for counties, census tracts, or regions. For our US counties data, we can visualize the distribution of per capita incomes for the first year in the sample as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">seaborn</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;1969&#39;, ylabel=&#39;Count&#39;&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_9_1.png" src="../_images/09_spatial_inequality_9_1.png" />
</div>
</div>
<p>Looking at this distribution, notice that the right side of the distribution is much longer than the left side. This long right tail is a prominent feature of the distribution, and is common in the study of incomes, as it reflects the fact that within a single income distribution, the super-rich are generally much more wealthy than the super-poor are deprived.</p>
<p>A key point to keep in mind here is that the unit of measurement in this data is a spatial aggregate of individual incomes. Here, we are using the per-capita incomes for each county. By contrast, in the wider inequality literature, the observational unit is typically a household or individual. In the latter distributions, the degree of skewness is often more pronounced. This difference arises from the smoothing that is intrinsic to aggregation: the regional distributions are based on averages obtained from the individual distributions, and so the extremely high-income individuals are averaged with the rest of their county.</p>
<p>The kernel density estimate (or histogram) is a powerful visualization device that captures the overall morphology of the <em>feature</em> distribution for this measure of income. At the same time, the density is silent on the underlying <em>geographic distribution</em> of county incomes. We can look at this second view of the distribution using a choropleth map. To construct this, we can use the standard <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> plotting tools. First, though, we will clean up the data for mapping. We do this by first setting the coordinate reference system (as it is currently missing) and then by re-projecting the data into a coordinate reference system suitable for mapping, the Albers Equal Area projection for North America:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pci_df</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span> <span class="c1"># US Census default projection</span>
                <span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">5070</span><span class="p">))</span> <span class="c1"># Albers Equal Area North America</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;1969&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;Quantiles&#39;</span><span class="p">,</span> 
            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
            <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="s1">&#39;lower left&#39;</span><span class="p">},</span> 
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Per Capita Income by County, 1969&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_13_0.png" src="../_images/09_spatial_inequality_13_0.png" />
</div>
</div>
<p>The choropleth and the kernel density provide different visual depictions of the distribution of county incomes. The kernel density estimate is a <em>feature</em>-based representation, and the map is a <em>geographic</em> representation. Both are useful for developing an understanding of the overall. To gain more specific insights on the level of inequality in the distribution, we’ll discuss a few inequality indices common in econometrics.</p>
<div class="section" id="ratio">
<h3>20:20 Ratio<a class="headerlink" href="#ratio" title="Permalink to this headline">¶</a></h3>
<p>One commonly used measure of inequality in a distribution is the so called 20:20 ratio, which is defined as the ratio of the incomes at the 80th percentile over that at the 20th percentile:</p>
<!-- #endregion --><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">top20</span><span class="p">,</span> <span class="n">bottom20</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">top20</span><span class="o">/</span><span class="n">bottom20</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>1.5022494887525562
</pre></div>
</div>
</div>
</div>
<p>In 1969 the richest 20% of the counties had an income that was 1.5 times the poorest 20% of the counties. The 20:20 ratio has the advantage of being robust to outliers at the top and the bottom of the distribution.</p>
<p>We can examine the dynamics of this global inequality measure by creating a simple function to apply to all years in our time series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ineq_2020</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">top20</span><span class="p">,</span> <span class="n">bottom20</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">top20</span><span class="o">/</span><span class="n">bottom20</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1969</span><span class="p">,</span> <span class="mi">2018</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">ratio_2020</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">years</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ineq_2020</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">ratio_2020</span><span class="p">)</span>
<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">years</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;20:20 ratio&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">figure</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_20_0.png" src="../_images/09_spatial_inequality_20_0.png" />
</div>
</div>
<p>The ratio has a U-shaped pattern over time, bottoming out around 1994 after a long decline. Post 1994, however, the 20:20 ratio indicates there is increasing inequality up until 2013, where there is a turn towards lower income inequality between the counties.</p>
<p>For other classic measures of inequality, we will use the <code class="docutils literal notranslate"><span class="pre">inequality</span></code> package from <code class="docutils literal notranslate"><span class="pre">pysal</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysal.explore</span> <span class="kn">import</span> <span class="n">inequality</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="gini-index">
<h3>Gini Index<a class="headerlink" href="#gini-index" title="Permalink to this headline">¶</a></h3>
<p>The Gini index is a longstanding measure of inequality. It can be derived in a number of ways. One of the simplest ways to define the Gini Curve is <em>via</em> the cumulative wealth distribution, called the <em>Lorenz</em> curve. To plot a Lorenz curve, the cumulative share of wealth is plotted against the share of the population that owns that wealth. For example, in an extremely unequal society where few people own nearly all the wealth, the Lorenz curve increases very slowly at first, then skyrockets the wealthiest people are included.</p>
<p>In contrast, a “perfectly equal” society would look like a straight line connecting <span class="math notranslate nohighlight">\((0,0)\)</span> and <span class="math notranslate nohighlight">\((1,1)\)</span>. This is called the <em>line of perfect equality</em>, and represents the case where <span class="math notranslate nohighlight">\(p\)</span>% of the population owns exactly <span class="math notranslate nohighlight">\(p\)</span>% of the wealth. For example, this might mean that 50% of the population earns exactly 50% of the income, or 90% of the population owns 90% of the wealth. The main idea is that the share of wealth or income is exactly proportional to the share of population that owns that wealth or earns that income, which occurs only when everyone has the same income or owns the same amount of wealth.</p>
<p>With this, we can define the Gini index as the ratio of the area between the line of perfect equality and the Lorenz curve for a given income or wealth distribution, standardized by the area under the line of perfect equality (which is always <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span>). Thus, the Gini index is a measure of the gap between a perfectly equal society and the observed society over every level of wealth/income.</p>
<p>We can construct one of the Lorenz curves for 1969 by first computing the share of population below each observation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pci_df</span><span class="p">)</span>
<span class="n">share_of_population</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we need to find out how many incomes are <em>smaller than</em> the values for each observation. Empirically, this can be computed by first sorting the incomes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">incomes</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we need to find the overall percentage of income at (or below) each value. To do this, we need to first compute what percentage of the total income each income represents:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shares</span> <span class="o">=</span> <span class="n">incomes</span> <span class="o">/</span> <span class="n">incomes</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we construct the <em>cumulative sum</em> of these shares, which reflects the sum of all of the shares of income up to the current one:
<span class="math notranslate nohighlight">\($ \texttt{cumsum(v, k)} = \sum_{i=1}^k v_i\)</span>$</p>
<p>This starts at <span class="math notranslate nohighlight">\(0\)</span> and reaches <span class="math notranslate nohighlight">\(1\)</span> once the last share is included.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cumulative_share</span> <span class="o">=</span> <span class="n">shares</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>With this, we can plot both the Lorenz curve and the line of perfect equality:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">share_of_population</span><span class="p">,</span> <span class="n">cumulative_share</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lorenz&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Equality&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Share of population&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Share of income&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_33_0.png" src="../_images/09_spatial_inequality_33_0.png" />
</div>
</div>
<p>The blue line is the Lorenze curve for county incomes in 1969. The Gini index is the area between it and the 45-degree line of equality shown in red, all standardized by the area underneath the line of equality.</p>
<p>To examine how inequality evolves over time, we will plot the Lorenz curves for each year. To do this, we can create a function that will compute the Lorenz curve for arbitrary inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lorenz</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">incomes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">income_shares</span> <span class="o">=</span> <span class="p">(</span><span class="n">incomes</span> <span class="o">/</span> <span class="n">incomes</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pop_shares</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="k">return</span> <span class="n">pop_shares</span><span class="p">,</span> <span class="n">income_shares</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we use the same method as before to compute lorenz curves (as a set of population shares that correspond to income shares) in each time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lorenz_curves</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">years</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">lorenz</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Practically, this becomes a dataframe with columns for each year. Rows contain the population shares (or income shares) as lists.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lorenz_curves</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>...</th>
      <th>2008</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
      <td>[0.00032509752925877764, 0.0006501950585175553...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[0.00012248644113964493, 0.0002529565611185806...</td>
      <td>[0.00013470713147942766, 0.0002749742242147042...</td>
      <td>[0.00013565871276465116, 0.0002735829350945102...</td>
      <td>[0.000138851418132282, 0.0002856978062862818, ...</td>
      <td>[0.00013772329900895125, 0.0002789403397482158...</td>
      <td>[0.00013670247958589532, 0.0002822671421734887...</td>
      <td>[0.00013545577965044458, 0.0002969630997663923...</td>
      <td>[0.00013285409901160207, 0.0002894117453533050...</td>
      <td>[0.0001243028615204895, 0.00025562579972132935...</td>
      <td>[0.00012461982501385657, 0.0002617767612857009...</td>
      <td>...</td>
      <td>[0.00014337413757142982, 0.0002952111969255050...</td>
      <td>[0.0001456829143536576, 0.00030689603606708245...</td>
      <td>[0.00014395847223286045, 0.000300079481701999,...</td>
      <td>[0.00014303960415837748, 0.0002879780824635754...</td>
      <td>[0.00014868735880996665, 0.0003029537221659007...</td>
      <td>[0.00014777376351708422, 0.0002978443977606638...</td>
      <td>[0.00011563121829018938, 0.0002592947418121832...</td>
      <td>[0.00010564770915523224, 0.0002539806359455832...</td>
      <td>[0.00014203484354254357, 0.0002909593179418555...</td>
      <td>[9.276898012960255e-05, 0.0002421381514532987,...</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 49 columns</p>
</div></div></div>
</div>
<p>By iterating over the columns of this dataframe, we can make a plot of the lorenz curves for each year:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">lorenz_curves</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">pop_shares</span><span class="p">,</span> <span class="n">inc_shares</span> <span class="o">=</span> <span class="n">lorenz_curves</span><span class="p">[</span><span class="n">year</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pop_shares</span><span class="p">,</span> <span class="n">inc_shares</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_41_0.png" src="../_images/09_spatial_inequality_41_0.png" />
</div>
</div>
<p>The compression of the Lorenze curves makes it difficult to ascertain the temporal pattern in inequality. Focusing explicilty on the Gini coefficients may shed more light on the evolution of inequality over time.</p>
<p>To express this, we first show that the Gini coefficient is computed by the <code class="docutils literal notranslate"><span class="pre">Gini</span></code> class in <code class="docutils literal notranslate"><span class="pre">inequality</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g69</span> <span class="o">=</span> <span class="n">inequality</span><span class="o">.</span><span class="n">gini</span><span class="o">.</span><span class="n">Gini</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To actually get the coefficient, we extract the <code class="docutils literal notranslate"><span class="pre">g</span></code> property. Here, the Gini coefficient in 1969 was .13:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g69</span><span class="o">.</span><span class="n">g</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.13556175504269904
</pre></div>
</div>
</div>
</div>
<p>To do this for all years, we can use a similar pattern as we have before. First, define a function to compute the quantity of interest. Then, apply the function across the dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gini</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inequality</span><span class="o">.</span><span class="n">gini</span><span class="o">.</span><span class="n">Gini</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">g</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">years</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">gini</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;gini&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we have the results as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gini</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1969</th>
      <td>0.135562</td>
    </tr>
    <tr>
      <th>1970</th>
      <td>0.130076</td>
    </tr>
    <tr>
      <th>1971</th>
      <td>0.128540</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>0.129126</td>
    </tr>
    <tr>
      <th>1973</th>
      <td>0.142166</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And, to make a plot, we use the standard <code class="docutils literal notranslate"><span class="pre">pandas</span></code> methods, which reveals a similar pattern to the 20:20 ratio above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_52_1.png" src="../_images/09_spatial_inequality_52_1.png" />
</div>
</div>
</div>
<div class="section" id="theil-s-index">
<h3>Theil’s index<a class="headerlink" href="#theil-s-index" title="Permalink to this headline">¶</a></h3>
<p>A third commonly used measure of inequality is Theil’s <span class="math notranslate nohighlight">\(T\)</span> given as:
<span class="math notranslate nohighlight">\($T = \sum_{i=1}^m \left( \frac{y_i}{\sum_{i=1}^m y_i} \ln \left[ m \frac{y_i}{\sum_{i=1}^m y_i}\right] \right)\)</span>$
where <span class="math notranslate nohighlight">\(y_i\)</span> is per-capita income in area <span class="math notranslate nohighlight">\(i\)</span> among <span class="math notranslate nohighlight">\(m\)</span> areas. Conceptually, this metric is related to the entropy of the income distribution, measuring how evenly-distributed incomes are across the population. However, elucidating the deeper links between these concepts is beyond the scope of this chapter.</p>
<p>We can calculate the Theil index using the same methods as above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">theil</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inequality</span><span class="o">.</span><span class="n">theil</span><span class="o">.</span><span class="n">Theil</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;theil&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">years</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">theil</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([&lt;AxesSubplot:&gt;, &lt;AxesSubplot:&gt;], dtype=object)
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_56_1.png" src="../_images/09_spatial_inequality_56_1.png" />
</div>
</div>
<p>The time paths of the Gini and the Theil coefficients show striking
similarities. At first glance, this might suggest that the indices are
substitutes for one another. However, they are not perfectly correlated:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">seaborn</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;theil&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">inequalities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;theil&#39;, ylabel=&#39;gini&#39;&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_58_1.png" src="../_images/09_spatial_inequality_58_1.png" />
</div>
</div>
<p>Indeed, as we shall see below, each index has
properties that lend themselves to particular spatial extensions that work in complementary ways. We need both (and more) for a complete picture.</p>
</div>
</div>
<div class="section" id="personal-versus-regional-income">
<h2>Personal versus Regional Income<a class="headerlink" href="#personal-versus-regional-income" title="Permalink to this headline">¶</a></h2>
<p>There is a subtle but important distinction between the study of personal and
regional income inequality. To see this, we first need to express the
relationships between the two types of inequality. Consider a country composed
of <span class="math notranslate nohighlight">\(N\)</span> individuals who are distributed over <span class="math notranslate nohighlight">\(m\)</span> regions. Let <span class="math notranslate nohighlight">\(Y_l\)</span> denote the
income of individual <span class="math notranslate nohighlight">\(l\)</span>. Total personal income in region <span class="math notranslate nohighlight">\(i\)</span> is given as <span class="math notranslate nohighlight">\(Y_i =
\sum_{l \in i} Y_l\)</span>. Per-capita income in region <span class="math notranslate nohighlight">\(i\)</span> is <span class="math notranslate nohighlight">\(y_i = \frac{Y_i}{N_i}\)</span>,
where <span class="math notranslate nohighlight">\(N_i\)</span> is the number of individuals in region <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>At the national level,  the coefficient of variation in incomes could be used as an index of interpersonal income inequality. This would be:</p>
<div class="math notranslate nohighlight">
\[CV_{nat} = \sqrt{\frac{\sum_{l=1}^N (Y_l - \bar{y})^2}{N}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar{y}\)</span> is national per-capita income. The key component here is the sum
of squares term, and unpacking this sheds light on personal versus regional
inequality question:</p>
<div class="math notranslate nohighlight">
\[TSS = \sum_{l=1}^N (Y_l - \bar{y})^2\]</div>
<p>Focusing on an individual deviation: <span class="math notranslate nohighlight">\(\delta_l = Y_l - \bar{y}\)</span>, this is the contribution to inequality associated with individual <span class="math notranslate nohighlight">\(l\)</span>. We can break this into two components:</p>
<div class="math notranslate nohighlight">
\[\delta_l = (Y_l - y_i) +  (y_i - \bar{y})\]</div>
<p>The first term is the difference between the individual’s income and per-capita income in the individual’s region of residence, while the second term is the difference between the region’s per capita income and average national per capita income.</p>
<p>In regional studies, the intraregional personal income distribution is typically
not available. As a result, the assumption is often made that intraregional
personal inequality is zero. In other words, all individuals in the same region
have identical incomes. With this assumption in hand, the first term vanishes:
<span class="math notranslate nohighlight">\(Y_l -y_i = 0\)</span>, leading to:<a class="footnote-reference brackets" href="#reg" id="id3">1</a></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
TSS &amp;= \sum_{l=1}^N (Y_l - \bar{y})^2 \\
    &amp;= \sum_{l=1}^N \delta_l^2 \\
    &amp;= \sum_{l=1}^N ((Y_l - y_i) +  (y_i - \bar{y}))^2 \\
    &amp;= \sum_{l=1}^N (0 +  (y_i - \bar{y}))^2 \\
    &amp;= \sum_{i=1}^m\sum_{l \in i}  (y_i - \bar{y})^2 \\
    &amp;= \sum_{i=1}^m  [N_i(y_i - \bar{y})]^2
\end{aligned}
\end{split}\]</div>
<p>This means that each individual in a region has an equal contribution to the
overall level of national interpersonal inequality, given by <span class="math notranslate nohighlight">\((y_i - \bar{y})\)</span>,
while the region in question contributes <span class="math notranslate nohighlight">\(N_i(y_i - \bar{y})\)</span>. While it may seem
that the assumption of zero intraregional interepersonal income inequality is
overly restrictive, it serves to isolate the nature of interregional income
inequality. That is, inequality between places, rather than inequality between
people within those places. In essence, this strategy shifts the question up one
level in the spatial hierarchy by aggregating micro-level individual data to
areal units.</p>
</div>
<div class="section" id="id4">
<h2>Spatial Inequality<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>The analysis of regional income inequality is distinguished from the analysis of
national interpersonal income inequality in its focus on spatial units. As
regional incomes are embedded in geographical space, it is important to consider
the special nature of spatial data. In the regional inequality literature this
has been approaches in a number of ways.</p>
<div class="section" id="spatial-autocorrelation">
<h3>Spatial Autocorrelation<a class="headerlink" href="#spatial-autocorrelation" title="Permalink to this headline">¶</a></h3>
<p>To get some insights on the spatial properties of regional income data, we can
turn to global measures of spatial autocorrelation that we encountered earlier in the book. We use a queen spatial weights matrix to calculate Moran’s I for
each year in the sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysal.explore</span> <span class="kn">import</span> <span class="n">esda</span>
<span class="kn">from</span> <span class="nn">pysal.lib</span> <span class="kn">import</span> <span class="n">weights</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wq</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">Queen</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">pci_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wq</span><span class="o">.</span><span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>3076
</pre></div>
</div>
</div>
</div>
<p>Then, as before, we create a function that returns the results we need from each statistic. Here, we will also keep the <span class="math notranslate nohighlight">\(p\)</span>-value for the Moran statistic, which indicates whether it is statistically significant under the null hypothesis that incomes are randomly distributed geographically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">moran</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">wq</span><span class="p">):</span>
    <span class="n">mo</span> <span class="o">=</span> <span class="n">esda</span><span class="o">.</span><span class="n">Moran</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mo</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">mo</span><span class="o">.</span><span class="n">p_sim</span>
</pre></div>
</div>
</div>
</div>
<p>Using this function, we compute each of these statistics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">moran_stats</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">years</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">moran</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Further, we then re-arrange them from being one long list of (<span class="math notranslate nohighlight">\(I\)</span>, <span class="math notranslate nohighlight">\(p\)</span>-value) into two lists that solely contain <span class="math notranslate nohighlight">\(I\)</span> and <span class="math notranslate nohighlight">\(p\)</span>-values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">moran_coefs</span><span class="p">,</span> <span class="n">p_values</span>  <span class="o">=</span> <span class="n">moran_stats</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we will store these as columns in the <code class="docutils literal notranslate"><span class="pre">inequalities</span></code> dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;moran&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">moran_coefs</span>
<span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;moran_pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_values</span>
</pre></div>
</div>
</div>
</div>
<p>To show the overall inter-relationships between these statistics, we make another plot below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_76_0.png" src="../_images/09_spatial_inequality_76_0.png" />
</div>
</div>
<p>Several patterns emerge from the time series of Moran’s I. First, the is a long-term decline in the value of Moran’s I. This suggests a gradual decline in the geographic structure of inequality with two implications: (a) per capita incomes are now less similar between nearby counties and (b), this has been consistently declining, regardless of whether inequality is high or low.</p>
<p>Second, despite this decline, there is never a year in which the spatial autocorrelation is not statistically significant. In other words, there is a strong geographic structure in the distribution of regional incomes that needs to be accounted for when focusing on inequality questions.</p>
</div>
<div class="section" id="decompositional-approaches">
<h3>Decompositional Approaches<a class="headerlink" href="#decompositional-approaches" title="Permalink to this headline">¶</a></h3>
<p>One common objection to the analysis of inequality in aggregate is about confounding. Inequality can be driven by differences between groups and not by discrepancies in income between similar individuals. That is, there is always the possibility that observed inequality can be “explained” by a confounding variate, such as age, sex, or education. For example, income differences between older and younger people can “explain” a large part of the societal inequality in wealth: older people have much longer to acquire experience, and thus are generally paid more for that experience. Younger people do not have as much experience, so young people (on average) have lower incomes than older people.</p>
<p>To combat this issue, it is often useful to <em>decompose</em> inequality indices into constituent groups. This allows us to understand how much of inequality is driven by aggregate group differences and how much is driven by observation-level inequality. This also allows us to characterize how unequal each group is separately. In geographic applications, these groups are usually spatially defined, in that <em>regions</em> are contiguous geographic groups of observations. Thus, we will dicuss regional inequality decompositions in the following sections as a way to introduce geography into the study of inequality.</p>
<!-- #region {"ein.tags": "worksheet-0", "slideshow": {"slide_type": "-"}} -->
</div>
<div class="section" id="regional-inequality-decompositions">
<h3>Regional Inequality Decompositions<a class="headerlink" href="#regional-inequality-decompositions" title="Permalink to this headline">¶</a></h3>
<p>One way to introduce geography into the analysis of inequality is to use geography to define groups for decompositions. Theil’s <span class="math notranslate nohighlight">\(T\)</span>, which we encountered previously, can be decomposed using regions into so called <em>between</em> and <em>within</em> regional inequality components.</p>
<p>To define this regional income decomposition, we first re-define our observations of per capita incomes for <span class="math notranslate nohighlight">\(m\)</span> regional economies as <span class="math notranslate nohighlight">\(y = \left( y_1, y_2, \ldots, y_m \right)\)</span>. These are grouped into <span class="math notranslate nohighlight">\(\omega\)</span> mutually exclusive regions. Formally, this means that when <span class="math notranslate nohighlight">\(m_g\)</span> represents the number of areas assigned to region <span class="math notranslate nohighlight">\(g\)</span>, the total number of areas must be equal to the count of all the areas in each region: <span class="math notranslate nohighlight">\(\sum_{g=1}^{\omega} m_g=m\)</span>.<a class="footnote-reference brackets" href="#mut-ex" id="id5">2</a> With this notation, Theil’s index from above can be rewritten to emphasize its between and within components:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
T &amp;= \sum_{i=1}^m \left( \frac{y_i}{\sum_{i=1}^m y_i} \ln \left[ m \frac{y_i}{\sum_{i=1}^m y_i}\right] \right) \\
  &amp;= \left[ \sum_{g=1}^{\omega} s_{g} log(\frac{m}{m_g} s_g)  \right] + \left[ \sum_{g=1}^{\omega} s_g \sum_{i \in g} s_{i,g} log(m_g s_{i,g}) \right] \\
  &amp;= B + W \\
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(s_g = \frac{\sum_{i \in g} y_i}{\sum_i y_i}\)</span>, and   <span class="math notranslate nohighlight">\(s_{i,g} = y_i / \sum_{i \in g} y_i\)</span>.</p>
<p>The first term is the between regions inequality component, and the second is
the within regions inequality component. The within regions term is a weighted
average of inequality between economies belonging to the same region. Similar
to what is done above for the case of interpersonal inequality, the estimate of
the between region (group) component of the decomposition is based on setting
the incomes of all economies (individuals) belonging to a region (group) equal
to that of the regional (group) average of these per capita incomes. Now,
however, intraregional inequality between economies within the same region is
explicitly considered in the second component.<a class="footnote-reference brackets" href="#weight" id="id6">3</a></p>
<p>In our data, we record the United States Census Bureau regions, stored in the <code class="docutils literal notranslate"><span class="pre">Region</span></code> variable. These divide the country into eight regions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Region&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_81_1.png" src="../_images/09_spatial_inequality_81_1.png" />
</div>
</div>
<p>These regions’ names are:</p>
<ul class="simple">
<li><p>New England</p></li>
<li><p>Mideast</p></li>
<li><p>Great Lakes</p></li>
<li><p>Plains</p></li>
<li><p>Southeast</p></li>
<li><p>Southwest</p></li>
<li><p>Rocky Mountain</p></li>
<li><p>Far West</p></li>
</ul>
<p>We can map these region names to a new variable in our data and make a plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">region_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;New England&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Mideast&quot;</span><span class="p">,</span> 
                <span class="s2">&quot;Great Lakes&quot;</span><span class="p">,</span> 
                <span class="s2">&quot;Plains&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Southeast&quot;</span><span class="p">,</span> 
                <span class="s2">&quot;Southwest&quot;</span><span class="p">,</span> 
                <span class="s2">&quot;Rocky Mountain&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Far West&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;Region_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pci_df</span><span class="o">.</span><span class="n">Region</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">region</span><span class="p">:</span> <span class="n">region_names</span><span class="p">[</span><span class="n">region</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Region_Name&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">legend_kwds</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_87_1.png" src="../_images/09_spatial_inequality_87_1.png" />
</div>
</div>
<p>To see the income changes for each region separately, we can use standard <code class="docutils literal notranslate"><span class="pre">pandas</span></code> methods. First, we can group the data by region and compute the mean of each column. For good measure, we will also select only the year columns of interest:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span> <span class="o">=</span> <span class="n">pci_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Region_Name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">years</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>...</th>
      <th>2008</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
    </tr>
    <tr>
      <th>Region_Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Far West</th>
      <td>4026.353333</td>
      <td>4282.726667</td>
      <td>4605.933333</td>
      <td>5058.586667</td>
      <td>5621.780000</td>
      <td>6265.166667</td>
      <td>6749.706667</td>
      <td>7185.206667</td>
      <td>7694.146667</td>
      <td>8605.840000</td>
      <td>...</td>
      <td>36279.186667</td>
      <td>35611.180000</td>
      <td>36680.900000</td>
      <td>38548.673333</td>
      <td>39962.253333</td>
      <td>40579.226667</td>
      <td>42877.700000</td>
      <td>45247.820000</td>
      <td>46248.953333</td>
      <td>47928.013333</td>
    </tr>
    <tr>
      <th>Great Lakes</th>
      <td>3426.800459</td>
      <td>3575.077982</td>
      <td>3863.880734</td>
      <td>4199.541284</td>
      <td>4795.082569</td>
      <td>5156.715596</td>
      <td>5668.309633</td>
      <td>6146.045872</td>
      <td>6720.729358</td>
      <td>7398.935780</td>
      <td>...</td>
      <td>32971.137615</td>
      <td>32334.279817</td>
      <td>33621.401376</td>
      <td>35712.176606</td>
      <td>36784.635321</td>
      <td>37842.667431</td>
      <td>38810.309633</td>
      <td>39864.006881</td>
      <td>40735.772936</td>
      <td>41918.071101</td>
    </tr>
    <tr>
      <th>Mideast</th>
      <td>3745.112360</td>
      <td>4003.943820</td>
      <td>4263.578652</td>
      <td>4608.359551</td>
      <td>5073.617978</td>
      <td>5534.668539</td>
      <td>5994.792135</td>
      <td>6485.730337</td>
      <td>7042.426966</td>
      <td>7773.331461</td>
      <td>...</td>
      <td>39298.061798</td>
      <td>38791.646067</td>
      <td>40084.056180</td>
      <td>41977.707865</td>
      <td>43304.949438</td>
      <td>43733.797753</td>
      <td>45401.174157</td>
      <td>47022.191011</td>
      <td>47930.286517</td>
      <td>49987.123596</td>
    </tr>
    <tr>
      <th>New England</th>
      <td>3736.208955</td>
      <td>3984.611940</td>
      <td>4238.238806</td>
      <td>4567.477612</td>
      <td>4959.328358</td>
      <td>5338.358209</td>
      <td>5740.134328</td>
      <td>6333.537313</td>
      <td>6846.955224</td>
      <td>7585.776119</td>
      <td>...</td>
      <td>43129.701493</td>
      <td>42780.895522</td>
      <td>44309.119403</td>
      <td>46358.701493</td>
      <td>48058.731343</td>
      <td>48107.701493</td>
      <td>50086.671642</td>
      <td>52201.611940</td>
      <td>53493.805970</td>
      <td>55414.552239</td>
    </tr>
    <tr>
      <th>Plains</th>
      <td>3185.181230</td>
      <td>3463.689320</td>
      <td>3748.909385</td>
      <td>4273.289644</td>
      <td>5462.899676</td>
      <td>5389.299353</td>
      <td>5774.113269</td>
      <td>5824.689320</td>
      <td>6299.959547</td>
      <td>7291.336570</td>
      <td>...</td>
      <td>36260.812298</td>
      <td>35053.728155</td>
      <td>36949.754045</td>
      <td>41725.169903</td>
      <td>43098.207120</td>
      <td>44535.634304</td>
      <td>44770.778317</td>
      <td>44949.200647</td>
      <td>44198.533981</td>
      <td>44367.509709</td>
    </tr>
    <tr>
      <th>Rocky Mountain</th>
      <td>3320.837209</td>
      <td>3642.600000</td>
      <td>3869.986047</td>
      <td>4407.576744</td>
      <td>5147.102326</td>
      <td>5597.353488</td>
      <td>5814.697674</td>
      <td>6090.674419</td>
      <td>6506.418605</td>
      <td>7408.781395</td>
      <td>...</td>
      <td>34855.865116</td>
      <td>33196.893023</td>
      <td>34434.381395</td>
      <td>37304.758140</td>
      <td>39290.641860</td>
      <td>40389.246512</td>
      <td>42126.865116</td>
      <td>43665.418605</td>
      <td>43188.325581</td>
      <td>44321.232558</td>
    </tr>
    <tr>
      <th>Southeast</th>
      <td>2611.549758</td>
      <td>2829.139130</td>
      <td>3062.237681</td>
      <td>3388.372947</td>
      <td>3833.672464</td>
      <td>4187.850242</td>
      <td>4487.303382</td>
      <td>4969.260870</td>
      <td>5389.129469</td>
      <td>6047.577778</td>
      <td>...</td>
      <td>30011.254106</td>
      <td>29590.113043</td>
      <td>30387.192271</td>
      <td>31792.254106</td>
      <td>32852.524638</td>
      <td>33231.090821</td>
      <td>34305.962319</td>
      <td>35476.280193</td>
      <td>36012.045411</td>
      <td>37209.981643</td>
    </tr>
    <tr>
      <th>Southwest</th>
      <td>2968.305040</td>
      <td>3233.893899</td>
      <td>3443.859416</td>
      <td>3835.867374</td>
      <td>4486.610080</td>
      <td>4565.095491</td>
      <td>5182.435013</td>
      <td>5621.554377</td>
      <td>6045.092838</td>
      <td>6710.564987</td>
      <td>...</td>
      <td>32500.419098</td>
      <td>30991.137931</td>
      <td>33064.135279</td>
      <td>35886.458886</td>
      <td>37412.612732</td>
      <td>38892.190981</td>
      <td>41058.530504</td>
      <td>40829.559682</td>
      <td>39043.450928</td>
      <td>40153.835544</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 49 columns</p>
</div></div></div>
</div>
<p>Once we transpose this dataframe, we can plot the region sequences as distinct variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_92_1.png" src="../_images/09_spatial_inequality_92_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="regional-decomposition-of-inequality">
<h2>Regional Decomposition of Inequality<a class="headerlink" href="#regional-decomposition-of-inequality" title="Permalink to this headline">¶</a></h2>
<p>Now, we can compute the regional Theil decomposition using the <code class="docutils literal notranslate"><span class="pre">inequality</span></code> module of pysal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">theil_dr</span> <span class="o">=</span> <span class="n">inequality</span><span class="o">.</span><span class="n">theil</span><span class="o">.</span><span class="n">TheilD</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="n">years</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">pci_df</span><span class="o">.</span><span class="n">Region</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">theil_dr</span></code> object has the between and within components stored in the <code class="docutils literal notranslate"><span class="pre">bg</span></code> and <code class="docutils literal notranslate"><span class="pre">wg</span></code> attributes. The <code class="docutils literal notranslate"><span class="pre">bg</span></code> stands for the “between” component, and “wg” for the within component. For example the “between” component for each year is computed is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">theil_dr</span><span class="o">.</span><span class="n">bg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([0.00914353, 0.00822696, 0.00782675, 0.00768201, 0.01022634,
       0.0081274 , 0.00783943, 0.00572543, 0.00560271, 0.0054971 ,
       0.00511791, 0.00566001, 0.00486877, 0.00466134, 0.00474425,
       0.00424528, 0.00428434, 0.00453503, 0.00465829, 0.00456699,
       0.00467363, 0.00412391, 0.00366334, 0.00342112, 0.00327131,
       0.00312475, 0.00326071, 0.00359733, 0.00327591, 0.00363014,
       0.00382409, 0.00436261, 0.00399156, 0.00402506, 0.00397   ,
       0.00394649, 0.00353368, 0.00362698, 0.00400508, 0.00449814,
       0.0043533 , 0.00470988, 0.0063954 , 0.00642426, 0.00694236,
       0.00644971, 0.00591871, 0.00554072, 0.00528702])
</pre></div>
</div>
</div>
</div>
<p>storing these components in our result dataframe as before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;theil_between&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theil_dr</span><span class="o">.</span><span class="n">bg</span>
<span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;theil_within&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theil_dr</span><span class="o">.</span><span class="n">wg</span>
<span class="n">inequalities</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;moran_pvalue&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can visualize them alongside our earlier results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_101_0.png" src="../_images/09_spatial_inequality_101_0.png" />
</div>
</div>
<p>Inference on these decompositions can be done using the <code class="docutils literal notranslate"><span class="pre">inequality.theil.TheilDSim</span></code> class, but we omit that here for brevity and report that, like the Moran’s <span class="math notranslate nohighlight">\(I\)</span>, all of the Theil decompositions are statistically significant. Further, since the within and between components are interpreted as shares of the overall Theil index, we can compute the share of the Theil index due to the between-region inequality, and note that it also generally shares the same pattern, but does not see minima in the same places. The between-region share of inequality is at its lowest in the mid-2000s, not in the mid-1990s. This suggests that regional differences were very important in the 1970s and 80s, but this importance has been waning, relative to the inequality <em>within</em> US Census Regions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;theil_between_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;theil_between&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;theil&#39;</span><span class="p">]</span>
<span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;theil_between_share&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_103_0.png" src="../_images/09_spatial_inequality_103_0.png" />
</div>
</div>
<!-- #region {"ein.tags": "worksheet-0", "slideshow": {"slide_type": "-"}} -->
<div class="section" id="spatializing-classic-measures">
<h3>Spatializing Classic Measures<a class="headerlink" href="#spatializing-classic-measures" title="Permalink to this headline">¶</a></h3>
<p>While regional decompositions are useful, they do not tell the whole story. Indeed, a “region” is just a special kind of geographical group; its “geography” is only made manifest through group membership: is the county “in” the region or not? This kind of “place-based” thinking, while geographic, is not necessarily <em>spatial</em>. It does not incorporate the notions of distance or proximity into the study of inequality; the geographical locations of the regions could be re-arranged without impact, so long as the group membership structure is maintained. While, arguably, shuffling regions around means they are no longer “regions,” the statistical methods do not differentiate.</p>
<p>So, we will now turn to two newer methods for analyzing inequality that include more spatial elements. These “spatial” measures of inequality care directly about the</p>
<div class="section" id="spatial-gini">
<h4>Spatial Gini<a class="headerlink" href="#spatial-gini" title="Permalink to this headline">¶</a></h4>
<p>The first spatial extension was introduced by <a class="bibtex reference internal" href="references.html#rey-2012" id="id7">[RS12]</a> and is designed to consider
the role of adjacency in a decomposition of the Gini index of inequality. One formulation for the Gini coefficient we discussed above focuses on the set of pairwise absolute differences in incomes:
<span class="math notranslate nohighlight">\($G = \frac{\sum_i \sum_j \left | y_i - y_j \right|}{2 n^2 \bar{x}} $\)</span></p>
<p>Focusing on the set of pairwise absolute differences in income, we can de-compose this into the set of differences between “nearby” observations and the set of differences among “distant” observations. This is the main conceptual point of the “Spatial Gini” coefficient. This decomposition works similarly to the regional decomposition of the Theil index:
<span class="math notranslate nohighlight">\($
\sum_i \sum_j \left |y_i - y_j \right | =\sum_i \sum_j \underset{\text{near differences}}{\left( w_{ij} \left |y_i - y_j \right | \right )} + \underset{\text{far differences}}{\left( (1-w_{ij})  \left |y_i - y_j \right | \right )}
$\)</span>
In this decomposition, <span class="math notranslate nohighlight">\(w_{ij}\)</span> is a binary variable that is <span class="math notranslate nohighlight">\(1\)</span> when <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are neighbors, and is zero otherwise. Recalling the spatial weights matrices from Chapter 4, this can be used directly from a spatial weights matrix.^[However, non-binary spatial weights matrices require a correction factor, and are not discussed here.] Thus, with this decomposition, the Spatial Gini can be stated as
<span class="math notranslate nohighlight">\($G = \frac{\sum_i \sum_j w_{i,j}\left | x_i - x_j \right|}{2 n^2 \bar{x}} +   \frac{\sum_i \sum_j \left (1-w_{i,j} )| x_i - x_j \right|}{2 n^2 \bar{x}}\)</span>$
with the first term being the component among neighbors and the second term being the component among non-neighbors. The “spatial Gini”, then, is the first component that describes the differences between nearby observations.</p>
<p>The spatial Gini allows for a consideration of the spatial dependence in inequality. If spatial depenedence is very strong and positive, incomes are very similar among nearby observations, so the inequality of “near” differences will be small. Most of the inequality in the society will be driven by disparities in income between distant places. In contrast, when dependence is very weak (or even negative), then the two components may equalize. Inference on the spatial Gini can be based on random spatial permutations of the income values, as we have seen elsewhere in this book. This tests whether the distribution of the compoents are different from that obtained when incomes are randomly distributed across the map.</p>
<p>The spatial Gini also provides a useful complement to the regional decomposition used in the Theil statistic. The latter does not consider pairwise relationships between observations, while the spatial Gini does. By considering the pairwise relationships between observations, the Gini coefficient is more sensitive, and can also be more strongly affected by small groups of significanatly wealthy observations.</p>
<p>We can estimate spatial Gini coefficients using the <code class="docutils literal notranslate"><span class="pre">Gini_Spatial</span></code> class:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">inequality.gini</span> <span class="kn">import</span> <span class="n">Gini_Spatial</span>
</pre></div>
</div>
</div>
</div>
<p>First, since the spatial Gini requires binary spatial weights, we will ensure this is so before proceeding:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wq</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Then, the spatial Gini can be computed from an income vector and the spatial weights describing adjacency among the observations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gs69</span> <span class="o">=</span> <span class="n">Gini_Spatial</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">],</span> <span class="n">wq</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The aspatial Gini is stored in the <code class="docutils literal notranslate"><span class="pre">g</span></code> attribute, just like for the aspatial class:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gs69</span><span class="o">.</span><span class="n">g</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.13556175504269904
</pre></div>
</div>
</div>
</div>
<p>The share of the overall gini coefficient that is due to the “far” differences is stored in the <code class="docutils literal notranslate"><span class="pre">wcg</span></code> share:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gs69</span><span class="o">.</span><span class="n">wcg_share</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.13541750749645268
</pre></div>
</div>
</div>
</div>
<p>The <span class="math notranslate nohighlight">\(p\)</span>-value for this tests whether the component measuring inequality among neighbors is larger (or smaller) than that would have occurred if incomes were shuffled randomly around the map:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gs69</span><span class="o">.</span><span class="n">p_sim</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.01
</pre></div>
</div>
</div>
</div>
<p>The value is statistically significant for 1969, indicating that inequality between neighboring pairs of counties is different from the inequality between county paris that are not geographically proximate.</p>
<p>We can apply the same statistic over each year in the sample using the same approach as before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gini_spatial</span><span class="p">(</span><span class="n">incomes</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">wq</span><span class="p">):</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">Gini_Spatial</span><span class="p">(</span><span class="n">incomes</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">incomes</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="n">weights</span><span class="o">.</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">gs</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">gs</span><span class="o">.</span><span class="n">wg</span><span class="o">/</span><span class="n">denom</span><span class="p">,</span> <span class="n">gs</span><span class="o">.</span><span class="n">wcg</span><span class="o">/</span><span class="n">denom</span><span class="p">,</span> <span class="n">gs</span><span class="o">.</span><span class="n">p_sim</span>
</pre></div>
</div>
</div>
</div>
<p>Inference on this estimator is computationally demanding, since the pairwise differences have to be re-computed every permutation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spatial_gini_results</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">years</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">gini_spatial</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">spatial_gini_results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;near_diffs&#39;</span><span class="p">,</span> <span class="s1">&#39;far_diffs&#39;</span><span class="p">,</span> <span class="s1">&#39;p_sim&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>...</th>
      <th>2008</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.135562</td>
      <td>0.130076</td>
      <td>0.128540</td>
      <td>0.129126</td>
      <td>0.142166</td>
      <td>0.130579</td>
      <td>0.130513</td>
      <td>0.117412</td>
      <td>0.117482</td>
      <td>0.115366</td>
      <td>...</td>
      <td>0.131644</td>
      <td>0.119542</td>
      <td>0.122588</td>
      <td>0.134640</td>
      <td>0.138565</td>
      <td>0.139039</td>
      <td>0.138952</td>
      <td>0.136074</td>
      <td>0.131118</td>
      <td>0.128393</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000144</td>
      <td>0.000141</td>
      <td>0.000142</td>
      <td>0.000140</td>
      <td>0.000145</td>
      <td>0.000141</td>
      <td>0.000142</td>
      <td>0.000135</td>
      <td>0.000136</td>
      <td>0.000133</td>
      <td>...</td>
      <td>0.000171</td>
      <td>0.000155</td>
      <td>0.000156</td>
      <td>0.000166</td>
      <td>0.000171</td>
      <td>0.000171</td>
      <td>0.000176</td>
      <td>0.000174</td>
      <td>0.000168</td>
      <td>0.000167</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.135418</td>
      <td>0.129935</td>
      <td>0.128398</td>
      <td>0.128985</td>
      <td>0.142021</td>
      <td>0.130438</td>
      <td>0.130371</td>
      <td>0.117277</td>
      <td>0.117346</td>
      <td>0.115233</td>
      <td>...</td>
      <td>0.131473</td>
      <td>0.119387</td>
      <td>0.122432</td>
      <td>0.134473</td>
      <td>0.138394</td>
      <td>0.138867</td>
      <td>0.138776</td>
      <td>0.135899</td>
      <td>0.130950</td>
      <td>0.128226</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>...</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 49 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spatial_gini_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gini</th>
      <th>near_diffs</th>
      <th>far_diffs</th>
      <th>p_sim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1969</th>
      <td>0.135562</td>
      <td>0.000144</td>
      <td>0.135418</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>1970</th>
      <td>0.130076</td>
      <td>0.000141</td>
      <td>0.129935</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>1971</th>
      <td>0.128540</td>
      <td>0.000142</td>
      <td>0.128398</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>0.129126</td>
      <td>0.000140</td>
      <td>0.128985</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>1973</th>
      <td>0.142166</td>
      <td>0.000145</td>
      <td>0.142021</td>
      <td>0.01</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The <span class="math notranslate nohighlight">\(p\)</span>-values are always small, suggesting that the contribution of the local ties is always smaller than that that would be expected if incomes were distributed randomly in the map.^[While it is possible that the “near differences” component could be <em>larger</em> than expected, that would imply negative spatial dependence, which is generally rare in empirical work.] We can compute the percent of times the <span class="math notranslate nohighlight">\(p\)</span>-value is smaller than a threshold using the mean:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">spatial_gini_results</span><span class="o">.</span><span class="n">p_sim</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<p>While it may appear that the component due to “near differences” is quite small, this has two reasons. First, the number of “nearby” pairs are less than 1% of all pairs of observations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wq</span><span class="o">.</span><span class="n">pct_nonzero</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.19385366975502275
</pre></div>
</div>
</div>
</div>
<p>Second, when spatial dependence is high, nearby observations will be similar. So, each “near difference” will also be small. Adding together a small number of small observations will generally be small, relative to the large differences between distant observations. Thus, small values of the “near” distances are indicative of spatial dependence.</p>
<p>Indeed, you can see that as the spatial dependence weakens, the <code class="docutils literal notranslate"><span class="pre">near_diffs</span></code> get larger:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="p">[</span><span class="s1">&#39;near_diffs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_gini_results</span><span class="o">.</span><span class="n">near_diffs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inequalities</span><span class="p">[[</span><span class="s1">&#39;near_diffs&#39;</span><span class="p">,</span> <span class="s1">&#39;moran&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([&lt;AxesSubplot:&gt;, &lt;AxesSubplot:&gt;], dtype=object)
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_129_1.png" src="../_images/09_spatial_inequality_129_1.png" />
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h1>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h1>
<p>Inequality is an important social phenomenon, and its geography is a serious, important concern for social scientists. This chapter discusses methods to assess inequality, as well as examine its spatial and regional structure. Through the Gini coefficient and Theil index, you can summarize the overall levels of inequality, as well as divide the components of inequality to those due to geographical region or proximate pairs of observations. Together, this gives us a good sense of how inequality manifests geographically, and how it is (possibly) distinct from other kinds of spatial measures, such as the measures of autocorrelation discussed in Chapter 7.</p>
</div>
<div class="section" id="questions">
<h1>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<dl class="footnote brackets">
<dt class="label" id="reg"><span class="brackets"><a class="fn-backref" href="#id3">1</a></span></dt>
<dd><p>It should also be noted that even at the national scale, the analysis of interpersonal income inequality also relies on aggregate data grouping individuals into income cohorts. See, for example, <a class="bibtex reference internal" href="references.html#piketty-2003" id="id8">[PS03]</a>.</p>
</dd>
<dt class="label" id="mut-ex"><span class="brackets"><a class="fn-backref" href="#id5">2</a></span></dt>
<dd><p>This would be violated, for example, if one area were in two regions. This area would get “double counted” in this total.</p>
</dd>
<dt class="label" id="weight"><span class="brackets"><a class="fn-backref" href="#id6">3</a></span></dt>
<dd><p>The regional decomposition does not involve weighting the regions by their respective population. See  <a class="bibtex reference internal" href="references.html#gluschenko-2018" id="id9">[Glu18]</a> for further details.</p>
</dd>
</dl>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-analysis-py"
        },
        kernelOptions: {
            kernelName: "conda-env-analysis-py",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-analysis-py'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="08_point_pattern_analysis.html" title="previous page">Point Pattern Analysis</a>
    <a class='right-next' id="next-link" href="10_clustering_and_regionalization.html" title="next page">Clustering &amp; Regionalization</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Sergio J. Rey, Dani Arribas-Bel, Levi J. Wolf<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-146598819-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>